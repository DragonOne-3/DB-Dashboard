name: G2B Multi-Year Collector (Py 3.12)

on:
  workflow_dispatch:
    inputs:
      start_date:
        description: '수집 시작일 (YYYYMMDD)'
        required: true
        default: '20220101'
      end_date:
        description: '수집 종료일 (YYYYMMDD)'
        required: true
        default: '20231231'

jobs:
  collect:
    runs-on: ubuntu-latest
    # 대량 데이터 수집 시 타임아웃 방지를 위해 실행 시간 넉넉히 설정 (최대 6시간)
    timeout-minutes: 360 
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # 최신 v4 사용

      - name: Set up Python 3.12
        uses: actions/setup-python@v5 # 최신 v5 사용
        with:
          python-version: '3.12'
          # pip 캐시를 사용하여 재실행 시 속도 향상
          cache: 'pip' 

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas requests google-api-python-client google-auth-httplib2 google-auth-oauthlib

      - name: Run G2B Notice Script
        env:
          DATA_GO_KR_API_KEY: ${{ secrets.DATA_GO_KR_API_KEY }}
          GOOGLE_AUTH_JSON: ${{ secrets.GOOGLE_AUTH_JSON }}
        run: |
          # 입력받은 인자를 파이썬 스크립트로 전달
          python G2B_notice.py ${{ github.event.inputs.start_date }} ${{ github.event.inputs.end_date }}
