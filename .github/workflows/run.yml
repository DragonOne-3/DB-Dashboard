name: Daily Procurement Data Bot

on:
  schedule:
    # í•œêµ­ ì‹œê°„ ê¸°ì¤€ ë§¤ì¼ 09:30 (UTC 00:30)
    - cron: '30 23 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ í™œì„±í™”

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install gspread oauth2client requests pytimekr

      - name: Run script
        id: run_script
        env:
          # Secretsì— ì €ì¥í•œ ë³€ìˆ˜ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ì£¼ì…
          DATA_GO_KR_API_KEY: ${{ secrets.DATA_GO_KR_API_KEY }}
          GOOGLE_AUTH_JSON: ${{ secrets.GOOGLE_AUTH_JSON }}
        run: python main.py

      - name: Send Email Notification
        if: always()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USER }}
          password: ${{ secrets.EMAIL_PASS }}
          subject: "ğŸ¤– [ì¡°ë‹¬ì²­ì•Œë¦¼] ${{ steps.run_script.outputs.collect_date }} ìˆ˜ì§‘ ê²°ê³¼"
          to: mhy9680@innodep.com
          from: GitHub Actions Bot
          body: |
            ì¡°ë‹¬ì²­ ë°ì´í„° ìë™ ìˆ˜ì§‘ ì‹œìŠ¤í…œ ì‘ì—… ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.
            
            - ìˆ˜ì§‘ ë‚ ì§œ: ${{ steps.run_script.outputs.collect_date }}
            - ì €ì¥ ê±´ìˆ˜: ${{ steps.run_script.outputs.collect_count }} ê±´
            - ì‹¤í–‰ ìƒíƒœ: ${{ job.status == 'success' && 'âœ… ì„±ê³µ' || 'âŒ ì‹¤íŒ¨' }}
            - ìƒì„¸ ë¡œê·¸: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            
            ë°ì´í„°ê°€ êµ¬ê¸€ ì‹œíŠ¸ì— ì •ìƒì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.
